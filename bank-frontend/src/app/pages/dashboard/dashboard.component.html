<header class="page-hero">
  <div class="hero-inner">
    <h1 class="hero-title">Open Banking</h1>

    <div class="hero-actions">
      <button class="btn ghost" (click)="openAddBank()">+ Banka Ekle</button>
      <button class="btn danger" (click)="logout()">GÃ¼venli Ã‡Ä±kÄ±ÅŸ</button>
    </div>

    <!-- Banka kartlarÄ± -->
    <div class="banks">
      <div
        class="bank-card"
        *ngFor="let b of banks(); trackBy: trackByIndex"
        [class.active]="selectedBank() === b.code"
        role="button" tabindex="0"
        (click)="selectBank(b.code)"
        (keyup.enter)="selectBank(b.code)"
      >
        <div class="left">
          <div class="logo">{{ b.name }}</div>
          <div class="balance" *ngIf="b.balanceTRY !== undefined">
            {{ b.balanceTRY | number:'1.2-2' }} TRY
          </div>
        </div>
        <div class="right">
          <span class="mini" *ngIf="b.connected">Connected</span>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- VakÄ±fBank hesaplarÄ± (tablo) -->
<section *ngIf="vakifMi(); else otherBanks" class="vb-wrapper">
  <h2>VakÄ±fBank</h2>
  <h3>Hesap Listesi</h3>

  <div class="table-scroll" *ngIf="vakifAccounts()?.length; else vbEmpty">
    <table class="vb-table">
      <thead>
        <tr>
          <th>Para Birimi</th>
          <th>Son Ä°ÅŸlem Tarihi</th>
          <th>Hesap Durumu</th>
          <th>IBAN</th>
          <th>Bakiye</th>
          <th>Hesap TÃ¼rÃ¼</th>
          <th>Hesap NumarasÄ±</th>
          <th style="width:220px">Aksiyon</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let acc of vakifAccounts(); trackBy: trackByIndex">
          <td>{{ acc.currency }}</td>
          <td>{{ acc.lastTransactionDate | date:'yyyy-MM-dd HH:mm:ss' }}</td>
          <td>{{ acc.status || 'Aktif' }}</td>
          <td class="mono">{{ acc.iban }}</td>
          <td class="num">{{ acc.balance | number:'1.2-2' }} TRY</td>
          <td>{{ acc.accountType }}</td>
          <td class="mono">{{ acc.accountNumber }}</td>
          <td class="actions">
            <button class="pill" (click)="openVbDetails(acc)">Hesap DetaylarÄ±</button>
            <button class="pill warn" (click)="openVbTransactions(acc)">Hesap Hareketleri</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #vbEmpty>
    <div class="empty">GÃ¶sterilecek VakÄ±fBank hesabÄ± bulunamadÄ±.</div>
  </ng-template>
</section>

<!-- DiÄŸer bankalar -->
<ng-template #otherBanks>
  <h2>Hesaplar</h2>
  <ul>
    <li *ngFor="let acc of accounts(); trackBy: trackByIndex">
      {{ acc.iban }} â€“ {{ acc.balance | number:'1.2-2' }} {{ acc.currency || 'TRY' }}
    </li>
  </ul>
</ng-template>

<!-- Son iÅŸlemler (SADECE MyBank iÃ§in) -->
<section *ngIf="!vakifMi()">
  <h2>Son Ä°ÅŸlemler</h2>
  <ul>
    <li *ngFor="let tx of recent(); trackBy: trackByIndex">
      {{ tx.date | date:'yyyy-MM-dd HH:mm:ss' }} â€“
      {{ tx.amount | number:'1.2-2' }} {{ tx.currency || 'TRY' }} â€“
      {{ tx.description }}
    </li>
  </ul>
</section>

<!-- ===================== -->
<!-- ðŸ”¹ HESAP DETAY MODALI -->
<!-- ===================== -->

<!-- Arkaplan -->
<div class="vb-backdrop" *ngIf="detailOpen()" (click)="closeDetail()"></div>

<!-- Modal iÃ§erik -->
<div class="vb-modal" *ngIf="detailOpen()" role="dialog" aria-modal="true" aria-label="Hesap DetaylarÄ±">
  <h3>Hesap DetaylarÄ±</h3>

  <!-- Servisin normalize ettiÄŸi TÃœRKÃ‡E alan adlarÄ± -->
  <div *ngIf="vbDetail() as d; else loadingTpl">
  <p class="vb-row"><strong>Para Birimi:</strong> {{ d.paraBirimi || '-' }}</p>
  <p class="vb-row"><strong>Son Ä°ÅŸlem Tarihi:</strong>
    {{ d.sonIslemTarihi ? (d.sonIslemTarihi | date:'yyyy-MM-dd HH:mm:ss') : '-' }}</p>
  <p class="vb-row"><strong>Hesap Durumu:</strong> {{ mapStatus(d.hesapDurumu) }}</p>
  <p class="vb-row"><strong>AÃ§Ä±lÄ±ÅŸ Tarihi:</strong>
    {{ d.acilisTarihi ? (d.acilisTarihi | date:'yyyy-MM-dd') : '-' }}</p>
  <p class="vb-row"><strong>IBAN:</strong> {{ d.iban || '-' }}</p>
  <p class="vb-row"><strong>MÃ¼ÅŸteri NumarasÄ±:</strong> {{ d.musteriNo || '-' }}</p>
  <p class="vb-row"><strong>Bakiye:</strong> {{ d.bakiye | number:'1.2-2' }} TRY</p>
  <p class="vb-row"><strong>Hesap TÃ¼rÃ¼:</strong> {{ mapAccountType(d.hesapTuru) }}</p>
  <p class="vb-row"><strong>Åžube Kodu:</strong> {{ d.subeKodu || '-' }}</p>
  <p class="vb-row"><strong>Hesap NumarasÄ±:</strong> {{ d.hesapNo || '-' }}</p>
</div>

  <ng-template #loadingTpl>
    <div class="vb-row" style="opacity:.7;">YÃ¼kleniyorâ€¦</div>
  </ng-template>

  <div class="vb-actions">
    <button class="vb-btn" (click)="closeDetail()">Close</button>
  </div>
</div>
